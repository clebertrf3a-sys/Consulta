<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Saldo</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 40px; }
        .box { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        h2 { color: #333; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; font-size: 16px; }
        #btnConsultar { background: #007bff; }
        #btnConsultar:hover { background: #0056b3; }
        #btnLimpar { background: #6c757d; }
        #btnLimpar:hover { background: #5a6268; }
        #res { margin-top: 20px; padding: 15px; border-radius: 5px; display: none; line-height: 1.6; }
    </style>
</head>
<body>

<div class="box">
    <h2>Consultar Valor</h2>
    <input type="text" id="nome" placeholder="Nome Completo">
    <input type="text" id="cpf" placeholder="000.000.000-00" maxlength="14" oninput="mascaraCPF(this)">
    
    <div class="btn-group">
        <button id="btnConsultar" onclick="consultar()">Consultar</button>
        <button id="btnLimpar" onclick="limpar()">Limpar</button>
    </div>
    
    <div id="res"></div>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzXTVVPfvHwvjcm65ZaaWQOkQys5zV0TpcrFWntCEWfOseTunzrWtS7A_uVh4Yxp7unWg/exec"; 

    // Função que coloca os pontos e o traço automaticamente
    function mascaraCPF(i) {
        let v = i.value;
        
        // Remove tudo o que não é dígito
        v = v.replace(/\D/g, "");

        // Coloca um ponto entre o terceiro e o quarto dígitos
        v = v.replace(/(\d{3})(\d)/, "$1.$2");

        // Coloca um ponto entre o sexto e o sétimo dígitos
        v = v.replace(/(\d{3})(\d)/, "$1.$2");

        // Coloca um hífen entre o nono e o décimo dígitos
        v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");

        i.value = v;
    }

    async function consultar() {
        const nome = document.getElementById('nome').value.trim();
        let cpfInput = document.getElementById('cpf').value.trim();
        const resDiv = document.getElementById('res');

        if(!nome || !cpfInput) return alert("Por favor, preencha todos os campos.");

        // Limpa o CPF para enviar apenas os números para o Google (Segurança extra)
        const cpfApenasNumeros = cpfInput.replace(/\D/g, '');

        resDiv.style.display = "block";
        resDiv.style.background = "#eee";
        resDiv.style.color = "#333";
        resDiv.innerHTML = "Aguarde, consultando...";

        try {
            const urlFinal = `${SCRIPT_URL}?nome=${encodeURIComponent(nome)}&cpf=${encodeURIComponent(cpfApenasNumeros)}`;
            const response = await fetch(urlFinal);
            const dados = await response.json();

            if (dados.status === "sucesso") {
                resDiv.style.background = "#d4edda";
                resDiv.style.color = "#155724";
                resDiv.innerHTML = `<strong>Sucesso!</strong><br>Olá, ${dados.nome}.<br>Seu saldo disponível é: <strong>${dados.saldo}</strong>`;
            } else {
                resDiv.style.background = "#f8d7da";
                resDiv.style.color = "#721c24";
                resDiv.innerHTML = "Os dados informados não foram encontrados.";
            }
        } catch (e) {
            resDiv.style.background = "#fff3cd";
            resDiv.style.color = "#856404";
            resDiv.innerHTML = "Erro ao conectar com o servidor. Tente novamente.";
        }
    }

    function limpar() {
        document.getElementById('nome').value = "";
        document.getElementById('cpf').value = "";
        const resDiv = document.getElementById('res');
        resDiv.style.display = "none";
        resDiv.innerHTML = "";
    }
</script>
</body>
</html>